function IsJsonString(str){try{JSON.parse(str);}catch(e){return false;}return true;}function fetchClasses(){$.ajax({url:domainUrl+"puidata/page_plugin/code.php?action=getClassList",}).done(function(data){var result=IsJsonString(data);if(result){var jsonData=$.parseJSON(data);}else{jsonData=data;}$("#selClassDropdown").empty();for(var x=0;x<=jsonData.length-1;x++){if(x==0){$("#selClassDropdown").append("<option value='select'>-Select Class-</option>");}$("#selClassDropdown").append("<option value='"+jsonData[x].node_class_id+"'>"+jsonData[x].caption+"</option>");}});$("#selClassDropdown").change(function(){$("#canvasNodeList ul").empty();if($(this).val()=="select"){$('#canvasNodeList').hide();return false;}$.ajax({url:domainUrl+"puidata/page_plugin/code.php?action=getClassPropertyStrVal&classId="+$(this).val(),}).done(function(data){var jsonData=$.parseJSON(data);buildTableClassStructure(jsonData);});});function buildTableClassStructure(getData,subClass){var getPropertyKey=Object.keys(getData.instances[0].property)[0];var getChilds=getData.instances[0].property[getPropertyKey];var getClassID=getData.node_id;if(subClass==undefined){$("#canvasNodeList ul:first").append("<li class='noMap classField' data-classID='"+getClassID+"'><span class='mappingNode' contenteditable='false'>"+getData.caption+"</span></li>");}else{$("#canvasNodeList ul:first").append("<li class='noMap classField subClass' data-classID='"+getClassID+"'><span class='mappingNode' contenteditable='false'>"+getData.caption+"</span></li>");}$("#canvasNodeList ul li:last").append("<ul><li class='noMap propertiesField'><span class='mappingNode' contenteditable='false'>"+getChilds.caption+"</span></li></ul>");if(Object.keys(getChilds).indexOf("child")!=-1){appendChildProperties(getChilds.child,$("#canvasNodeList ul li ul li:last"));}$('#canvasNodeList').show();if(getData.childsArray!=undefined){var getSubClasses=Object.keys(getData.childsArray);if(getSubClasses.length>0){for(var x=0;x<getSubClasses.length;x++){buildTableClassStructure(getData.childsArray[x],"subClass");}}}}function appendChildProperties(getData,getElement){var elm=getElement;var getChilds=Object.keys(getData);for(var k=0;k<getChilds.length;k++){var getnewChild=getData[getChilds[k]];if(getnewChild.child==undefined){elm.append("<li class='normal'><span class='mappingNode' contenteditable='false'>"+getnewChild.caption+"</span></li>");var dataSourceArray=[];elm.find("li:last").parents().each(function(){if($(this).attr("class")!=undefined){var getClassName=$(this).attr("class");if(getClassName.indexOf("classField")!=-1){dataSourceArray.push($(this).attr("data-classID")+"~"+"$"+"~");return false;}else if(getClassName.indexOf("headField")!=-1){dataSourceArray.push($(this).find("span:first").text());}}});dataSourceArray=dataSourceArray.reverse();var dataSource="";for(var s=0;s<dataSourceArray.length;s++){if(s==1||s==0){dataSource=dataSource+dataSourceArray[s];}else{dataSource=dataSource+">"+dataSourceArray[s];}}if(dataSourceArray.length==1){$("#canvasNodeList ul li:last span").attr("data-source",dataSource+$("#canvasNodeList ul li:last span").text());}else{$("#canvasNodeList ul li:last span").attr("data-source",dataSource+">"+$("#canvasNodeList ul li:last span").text());}}else{elm.append("<li class='noMap headField'><span class='mappingNode' contenteditable='false'>"+getnewChild.caption+"</span></li>");}var checkMoreChild=Object.keys(getnewChild);if(checkMoreChild.indexOf("child")!=-1){elm.find("li:last").append("<ul></ul>");var newElm=elm.find("li:last ul");appendChildProperties(getnewChild.child,newElm);}}}}window.puJsFileLoadCounter++;